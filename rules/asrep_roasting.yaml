id: "asrep_roasting"
name: "AS-REP Roasting"
description: "Detection of an AS-REP Roasting attack via event 4768."

event_id: 4768

# Mapping of canonical fields used in checks
field_map:
  timestamp: "TimeCreated"
  user: "TargetUserName"
  ip: "IpAddress"
  ticket_encryption_type: "TicketEncryptionType"
  preauth_type: "PreAuthType"

# Generic checks (no logic coded by rule)
checks:
  - field: ticket_encryption_type
    value: 0x17

  - field: preauth_type
    value: 0

  # Several events 4768 for the same (user, ip) in a short window
  - field: event_time
    value: 2     # number of events
    time: 1      # number of seconds
    join_by: [user, ip]

# Scoring based on the number of conditions that match.
scoring:
  1: 40
  2: 80
  3: 95

